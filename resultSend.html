<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>é ç´„å®Œæˆ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
  body {
    font-family: "Noto Sans TC", sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 0;
  }

  .header {
    background: #06C755;
    color: white;
    text-align: center;
    padding: 16px;
    font-size: 22px;
    font-weight: bold;
  }

  .container {
    padding: 20px;
  }

  .box {
    background: #fff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    margin-top: 16px;
  }

  .title {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 12px;
  }

  .item {
    margin: 6px 0;
    font-size: 16px;
  }

  .close-btn {
    width: 90%;
    margin: 30px auto;
    display: block;
    background: #06C755;
    color: #fff;
    border: none;
    font-size: 20px;
    padding: 14px;
    border-radius: 50px;
  }
</style>
</head>


<body>

<div class="header">é ç´„å®Œæˆ</div>

<div class="container">
  <div class="title">æ‚¨çš„é ç´„å·²é€å‡º</div>
  <div>âœ” é ç´„æ‘˜è¦å·²å‚³é€è‡³æ‚¨çš„ LINE èŠå¤©å®¤</div>

  <div class="box">
    <div class="title">é ç´„æ‘˜è¦</div>

    <div class="item">ğŸ“… æ—¥æœŸï¼š<span id="d_date"></span></div>
    <div class="item">â° æ™‚æ®µï¼š<span id="d_time"></span></div>
    <div class="item">ğŸ§‘â€ğŸ§‘â€ğŸ§’ å¤§äººï¼š<span id="d_adult"></span> ä½</div>
    <div class="item">ğŸ§’ å°å­©ï¼š<span id="d_child"></span> ä½</div>
    <div class="item">ğŸª‘ å…’ç«¥æ¤…ï¼š<span id="d_seat"></span></div>
    <div class="item">ğŸ“± æ‰‹æ©Ÿï¼š<span id="d_phone"></span></div>
    <div class="item">ğŸ“ å‚™è¨»ï¼š<span id="d_note"></span></div>
  </div>

  <button class="close-btn" id="closeBtn">é—œé–‰è¦–çª—</button>
</div>


<script>
const API_URL =
  "https://script.google.com/macros/s/AKfycbz2looN-W2dOY9RgJN2A327WOEs_bFfl18T1OaPvI1N7dYHPMdoLkHN9Y-3wuY4lkQm/exec";

(async () => {

  await liff.init({
    liffId: "2008586106-kLrdO1gp",
    withLoginOnExternalBrowser: false
  });

  const url = new URL(window.location.href);

  const data = {
    uid: url.searchParams.get("uid"),
    phone: url.searchParams.get("phone"),
    date: url.searchParams.get("date"),
    time: url.searchParams.get("time"),
    adult: url.searchParams.get("adult"),
    child: url.searchParams.get("child"),
    seat: url.searchParams.get("seat"),
    note: url.searchParams.get("note") || "ç„¡"
  };

  // å¡«å…¥é¡¯ç¤º
  document.getElementById("d_date").innerText = data.date;
  document.getElementById("d_time").innerText = data.time;
  document.getElementById("d_adult").innerText = data.adult;
  document.getElementById("d_child").innerText = data.child;
  document.getElementById("d_seat").innerText = data.seat || "ç„¡";
  document.getElementById("d_phone").innerText = data.phone;
  document.getElementById("d_note").innerText = data.note;

  // å¯«å…¥è©¦ç®—è¡¨ï¼ˆç…§èˆŠï¼‰
  try {
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify(data)
    });
  } catch (err) {
    console.error("âŒ GAS éŒ¯èª¤:", err);
  }

  /* --------------------------
     ç”Ÿæˆ Flex åœ–å¡ (æŒ‰ä¸‹é—œé–‰è¦–çª—æ‰é€)
  -------------------------- */
  const flexMsg = {
    type: "flex",
    altText: "æ‚¨çš„é ç´„å·²é€å‡ºï¼",
    contents: {
      type: "bubble",
      size: "mega",
      hero: {
        type: "image",
        url: "https://i.imgur.com/RFqVg1C.png",
        size: "full",
        aspectRatio: "16:9",
        aspectMode: "cover"
      },
      body: {
        type: "box",
        layout: "vertical",
        spacing: "md",
        contents: [
          {
            type: "text",
            text: "ğŸ½ é ç´„æˆåŠŸ",
            weight: "bold",
            size: "xl",
            color: "#06C755"
          },
          { type: "separator", margin: "md" },
          {
            type: "box",
            layout: "vertical",
            spacing: "sm",
            contents: [
              { type: "text", text: `ğŸ“… æ—¥æœŸï¼š${data.date}` },
              { type: "text", text: `â° æ™‚æ®µï¼š${data.time}` },
              { type: "text", text: `ğŸ§‘ å¤§äººï¼š${data.adult} ä½` },
              { type: "text", text: `ğŸ§’ å°å­©ï¼š${data.child} ä½` },
              { type: "text", text: `ğŸª‘ å…’ç«¥æ¤…ï¼š${data.seat}` },
              { type: "text", text: `ğŸ“± æ‰‹æ©Ÿï¼š${data.phone}` },
              { type: "text", text: `ğŸ“ å‚™è¨»ï¼š${data.note}` }
            ]
          }
        ]
      }
    }
  };

  // æŒ‰ä¸‹ã€Œé—œé–‰è¦–çª—ã€â†’ é€ Flex åœ–å¡ â†’ é—œé–‰
  document.getElementById("closeBtn").onclick = async () => {
    try {
      await liff.sendMessages([flexMsg]);
    } catch (err) {
      console.error("âŒ Flex å‚³é€å¤±æ•—ï¼š", err);
    }
    liff.closeWindow();
  };

})();
</script>

</body>
</html>
